

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Communication Protocol &mdash; kRPC 0.3.7 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
    <link rel="top" title="kRPC 0.3.7 documentation" href="index.html"/>
        <link rel="next" title="Internals of kRPC" href="internals.html"/>
        <link rel="prev" title="Extending kRPC" href="extending.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> kRPC
          

          
          </a>

          
            
            
              <div class="version">
                0.3.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials and Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="csharp.html">C#</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp.html">C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="java.html">Java</a></li>
<li class="toctree-l1"><a class="reference internal" href="lua.html">Lua</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="third-party.html">Other Clients, Services and Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiling.html">Compiling kRPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Extending kRPC</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Communication Protocol</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#establishing-a-connection">Establishing a Connection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#connecting-to-the-rpc-server">Connecting to the RPC Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connecting-to-the-stream-server">Connecting to the Stream Server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#remote-procedures">Remote Procedures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#invoking-remote-procedures">Invoking Remote Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anatomy-of-a-request">Anatomy of a Request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anatomy-of-a-response">Anatomy of a Response</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encoding-and-sending-requests-and-responses">Encoding and Sending Requests and Responses</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-rpc-invocation">Example RPC invocation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#protocol-buffer-encoding">Protocol Buffer Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="#streams">Streams</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#anatomy-of-a-stream-message">Anatomy of a Stream Message</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#krpc-service">KRPC Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getstatus">GetStatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getservices">GetServices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#addstream">AddStream</a></li>
<li class="toctree-l3"><a class="reference internal" href="#removestream">RemoveStream</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#service-description-message">Service Description Message</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#procedures">Procedures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enumerations">Enumerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attributes">Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#type-names">Type Names</a></li>
<li class="toctree-l3"><a class="reference internal" href="#proxy-objects">Proxy Objects</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Internals of kRPC</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">kRPC</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Communication Protocol</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/communication-protocol.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="communication-protocol">
<span id="id1"></span><h1>Communication Protocol<a class="headerlink" href="#communication-protocol" title="Permalink to this headline">¶</a></h1>
<p>Clients invoke Remote Procedure Calls (RPCs) by communicating with the server
using <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto3">Protocol Buffer v3 messages</a> sent over a
TCP/IP connection. The kRPC <a class="reference external" href="https://github.com/krpc/krpc/releases/latest">download</a> comes with a protocol buffer
message definitions file (<a class="reference external" href="https://github.com/krpc/krpc/blob/latest-version/protobuf/krpc.proto">schema/krpc.proto</a>) that
defines the structure of these messages. It also contains versions of this file
for C#, C++, Java, Lua and Python, compiled using <a class="reference external" href="https://github.com/google/protobuf">Google&#8217;s protocol buffers
compiler</a>.</p>
<p>The following sections describe how to communicate with kRPC using snippets of
Python code. A complete example script made from these snippets can be
<a class="reference download internal" href="_downloads/communication-protocol.py"><code class="xref download docutils literal"><span class="pre">downloaded</span> <span class="pre">here</span></code></a>.</p>
<div class="section" id="establishing-a-connection">
<h2>Establishing a Connection<a class="headerlink" href="#establishing-a-connection" title="Permalink to this headline">¶</a></h2>
<p>kRPC consists of two servers: an <em>RPC server</em> (over which clients send and
receive RPCs) and a <em>stream server</em> (over which clients receive
<a class="reference internal" href="#communication-protocol-streams"><span>Streams</span></a>). A client first connects to the <em>RPC
Server</em>, then (optionally) to the <em>Stream Server</em>.</p>
<div class="section" id="connecting-to-the-rpc-server">
<span id="communication-protocol-rpc-connect"></span><h3>Connecting to the RPC Server<a class="headerlink" href="#connecting-to-the-rpc-server" title="Permalink to this headline">¶</a></h3>
<p>To establish a connection to the RPC server, a client must do the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Open a TCP socket to the server on its RPC port (which defaults to 50000).</li>
<li>Send this 12 byte hello message:
<code class="docutils literal"><span class="pre">0x48</span> <span class="pre">0x45</span> <span class="pre">0x4C</span> <span class="pre">0x4C</span> <span class="pre">0x4F</span> <span class="pre">0x2D</span> <span class="pre">0x52</span> <span class="pre">0x50</span> <span class="pre">0x43</span> <span class="pre">0x00</span> <span class="pre">0x00</span> <span class="pre">0x00</span></code></li>
<li>Send a 32 byte message containing a name for the connection, that will be
displayed on the in-game server window. This should be a UTF-8 encoded
string, up to a maximum of 32 bytes in length. If the string is shorter than
32 bytes, it should be padded with zeros.</li>
<li>Receive a 16 byte unique client identifier. This is sent to the client when
the connection is granted, for example after the user has clicked accept on
the in-game UI.</li>
</ol>
</div></blockquote>
<p>For example, this python code will connect to the RPC server at address
<code class="docutils literal"><span class="pre">127.0.0.1:50000</span></code> using the identifier <code class="docutils literal"><span class="pre">Jeb</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socket</span>
<span class="n">rpc_conn</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">rpc_conn</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">50000</span><span class="p">))</span>
<span class="c1"># Send the 12 byte hello message</span>
<span class="n">rpc_conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;</span><span class="se">\x48\x45\x4C\x4C\x4F\x2D\x52\x50\x43\x00\x00\x00</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># Send the 32 byte client name &#39;Jeb&#39; padded with zeroes</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Jeb&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">name</span> <span class="o">+=</span> <span class="p">(</span><span class="n">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>
<span class="n">rpc_conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># Receive the 16 byte client identifier</span>
<span class="n">identifier</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">:</span>
    <span class="n">identifier</span> <span class="o">+=</span> <span class="n">rpc_conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">16</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>
<span class="c1"># Connection successful. Print out a message along with the client identifier.</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="n">printable_identifier</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Connected to RPC server, client idenfitier = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">printable_identifier</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="connecting-to-the-stream-server">
<h3>Connecting to the Stream Server<a class="headerlink" href="#connecting-to-the-stream-server" title="Permalink to this headline">¶</a></h3>
<p>To establish a connection to the stream server, a client must first
<a class="reference internal" href="#communication-protocol-rpc-connect"><span>connect to the RPC Server</span></a> then do
the following:</p>
<ol class="arabic simple">
<li>Open a TCP socket to the server on its stream port (which defaults to 50001).</li>
<li>Send this 12 byte hello message:
<code class="docutils literal"><span class="pre">0x48</span> <span class="pre">0x45</span> <span class="pre">0x4C</span> <span class="pre">0x4C</span> <span class="pre">0x4F</span> <span class="pre">0x2D</span> <span class="pre">0x53</span> <span class="pre">0x54</span> <span class="pre">0x52</span> <span class="pre">0x45</span> <span class="pre">0x41</span> <span class="pre">0x4D</span></code></li>
<li>Send a 16 byte message containing the client&#8217;s unique identifier. This
identifier is given to the client after it successfully connects to the RPC
server.</li>
<li>Receive a 2 byte OK message: <code class="docutils literal"><span class="pre">0x4F</span> <span class="pre">0x4B</span></code> This indicates a successful
connection.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Connecting to the Stream Server is optional. If the client doesn&#8217;t
require stream functionality, there is no need to connect.</p>
</div>
<p>For example, this python code will connect to the stream server at address
<code class="docutils literal"><span class="pre">127.0.0.1:50001</span></code>. Note that <code class="docutils literal"><span class="pre">identifier</span></code> is the unique client identifier
received when <a class="reference internal" href="#communication-protocol-rpc-connect"><span>connecting to the RPC server</span></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">stream_conn</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">stream_conn</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">50001</span><span class="p">))</span>
<span class="c1"># Send the 12 byte hello message</span>
<span class="n">stream_conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;</span><span class="se">\x48\x45\x4C\x4C\x4F\x2D\x53\x54\x52\x45\x41\x4D</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># Send the 16 byte client identifier</span>
<span class="n">stream_conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
<span class="c1"># Receive the 2 byte OK message</span>
<span class="n">ok_message</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">ok_message</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">ok_message</span> <span class="o">+=</span> <span class="n">stream_conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ok_message</span><span class="p">))</span>
<span class="c1"># Connection successful</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Connected to stream server&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="remote-procedures">
<h2>Remote Procedures<a class="headerlink" href="#remote-procedures" title="Permalink to this headline">¶</a></h2>
<p>Remote procedures are arranged into groups called <em>services</em>. These act as a
single-level namespacing to keep things organized. Each service has a unique
name used to identify it, and within a service each procedure has a unique name.</p>
<div class="section" id="invoking-remote-procedures">
<h3>Invoking Remote Procedures<a class="headerlink" href="#invoking-remote-procedures" title="Permalink to this headline">¶</a></h3>
<p>Remote procedures are invoked by sending a request message to the RPC server,
and waiting for a response message. These messages are encoded as Protocol
Buffer messages.</p>
<p>The request message contains the name of the procedure to invoke, and the values
of any arguments to pass it. The response message contains the value returned by
the procedure (if any) and any errors that were encountered.</p>
<p>Requests are processed in order of receipt. The next request from a client will
not be processed until the previous one completes execution and it&#8217;s response
has been received by the client. When there are multiple client connections,
requests are processed in round-robin order.</p>
</div>
<div class="section" id="anatomy-of-a-request">
<span id="communication-protocol-anatomy-of-a-request"></span><h3>Anatomy of a Request<a class="headerlink" href="#anatomy-of-a-request" title="Permalink to this headline">¶</a></h3>
<p>A request is sent to the server using a <code class="docutils literal"><span class="pre">Request</span></code> Protocol Buffer message with
the following format:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Request</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="kd">service</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">procedure</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">Argument</span> <span class="na">arguments</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">Argument</span> <span class="p">{</span>
  <span class="kt">uint32</span> <span class="na">position</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">bytes</span> <span class="na">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The fields are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">service</span></code> - The name of the service in which the remote procedure is defined.</li>
<li><code class="docutils literal"><span class="pre">procedure</span></code> - The name of the remote procedure to invoke.</li>
<li><code class="docutils literal"><span class="pre">arguments</span></code> - A sequence of <code class="docutils literal"><span class="pre">Argument</span></code> messages containing the values of the procedure&#8217;s
arguments. The fields are:<ul>
<li><code class="docutils literal"><span class="pre">position</span></code> - The zero-indexed position of the of the argument in the procedure&#8217;s
signature.</li>
<li><code class="docutils literal"><span class="pre">value</span></code> - The value of the argument, encoded in Protocol Buffer format.</li>
</ul>
</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">Argument</span></code> messages have a position field to allow values for default
arguments to be omitted. See <a class="reference internal" href="#communication-protocol-protobuf-encoding"><span>Protocol Buffer Encoding</span></a> for
details on how to serialize the argument values.</p>
</div>
<div class="section" id="anatomy-of-a-response">
<span id="communication-protocol-anatomy-of-a-response"></span><h3>Anatomy of a Response<a class="headerlink" href="#anatomy-of-a-response" title="Permalink to this headline">¶</a></h3>
<p>A response is sent to the client using a <code class="docutils literal"><span class="pre">Response</span></code> Protocol Buffer message
with the following format:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Response</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="na">time</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="na">has_error</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">error</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="na">has_return_value</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="kt">bytes</span> <span class="na">return_value</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The fields are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">time</span></code> - The universal time (in seconds) when the request completed
processing.</li>
<li><code class="docutils literal"><span class="pre">has_error</span></code> - True if there was an error executing the remote procedure.</li>
<li><code class="docutils literal"><span class="pre">error</span></code> - If <code class="docutils literal"><span class="pre">has_error</span></code> is true, contains a description of the error.</li>
<li><code class="docutils literal"><span class="pre">has_return_value</span></code> - True if the remote procedure returned a value.</li>
<li><code class="docutils literal"><span class="pre">return_value</span></code> - If <code class="docutils literal"><span class="pre">has_return_value</span></code> is true and <code class="docutils literal"><span class="pre">has_error</span></code> is false,
contains the value returned by the remote procedure, encoded in protocol
buffer format.</li>
</ul>
<p>See <a class="reference internal" href="#communication-protocol-protobuf-encoding"><span>Protocol Buffer Encoding</span></a> for details on how to
unserialize the return value.</p>
</div>
<div class="section" id="encoding-and-sending-requests-and-responses">
<h3>Encoding and Sending Requests and Responses<a class="headerlink" href="#encoding-and-sending-requests-and-responses" title="Permalink to this headline">¶</a></h3>
<p>To send a request:</p>
<ol class="arabic simple">
<li>Encode a <code class="docutils literal"><span class="pre">Request</span></code> message using the
<a class="reference internal" href="#communication-protocol-protobuf-encoding"><span>Protocol Buffer Encoding</span></a>.</li>
<li>Send the size in bytes of the encoded <code class="docutils literal"><span class="pre">Request</span></code> message, encoded as a
Protocol Buffer varint.</li>
<li>Send the message data.</li>
</ol>
<p>To receive a response:</p>
<ol class="arabic simple">
<li>Read a Protocol Buffer varint, which contains the length of the <code class="docutils literal"><span class="pre">Response</span></code>
message data in bytes.</li>
<li>Receive and decode the <code class="docutils literal"><span class="pre">Response</span></code> message.</li>
</ol>
</div>
<div class="section" id="example-rpc-invocation">
<h3>Example RPC invocation<a class="headerlink" href="#example-rpc-invocation" title="Permalink to this headline">¶</a></h3>
<p>The following Python script invokes the <code class="docutils literal"><span class="pre">GetStatus</span></code> procedure from the
<a class="reference internal" href="#communication-protocol-krpc-service"><span>KRPC service</span></a> using an already
established connection to the server (the <code class="docutils literal"><span class="pre">rpc_conn</span></code> variable).</p>
<p>The <code class="docutils literal"><span class="pre">krpc.schema.KRPC</span></code> package contains the Protocol Buffer message formats
<code class="docutils literal"><span class="pre">Request</span></code>, <code class="docutils literal"><span class="pre">Response</span></code> and <code class="docutils literal"><span class="pre">Status</span></code> compiled to python code using the
Protocol Buffer compiler. The <code class="docutils literal"><span class="pre">EncodeVarint</span></code> and <code class="docutils literal"><span class="pre">DecodeVarint</span></code> functions
are used to encode/decode integers to/from the Protocol Buffer varint
format.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># import the krpc.proto schema</span>
<span class="kn">import</span> <span class="nn">krpc.schema</span>

<span class="c1"># Utility functions to encode and decode integers to protobuf format</span>
<span class="kn">import</span> <span class="nn">google.protobuf</span>

<span class="k">def</span> <span class="nf">EncodeVarint</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">google</span><span class="o">.</span><span class="n">protobuf</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">_SignedVarintEncoder</span><span class="p">()(</span><span class="n">write</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">DecodeVarint</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">google</span><span class="o">.</span><span class="n">protobuf</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">_DecodeSignedVarint</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Create Request message</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">krpc</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">KRPC</span><span class="o">.</span><span class="n">Request</span><span class="p">()</span>
<span class="n">request</span><span class="o">.</span><span class="n">service</span> <span class="o">=</span> <span class="s1">&#39;KRPC&#39;</span>
<span class="n">request</span><span class="o">.</span><span class="n">procedure</span> <span class="o">=</span> <span class="s1">&#39;GetStatus&#39;</span>

<span class="c1"># Encode and send the request</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">EncodeVarint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="n">rpc_conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="n">data</span><span class="p">)</span>

<span class="c1"># Receive the size of the response data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="n">rpc_conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">DecodeVarint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="c1"># Receive the response data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="n">rpc_conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="c1"># Decode the response message</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">krpc</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">KRPC</span><span class="o">.</span><span class="n">Response</span><span class="p">()</span>
<span class="n">response</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Check for an error response</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">has_error</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;ERROR:&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>

<span class="c1"># Decode the return value as a Status message</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">krpc</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">KRPC</span><span class="o">.</span><span class="n">Status</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">has_return_value</span>
    <span class="n">status</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">return_value</span><span class="p">)</span>

    <span class="c1"># Print out the version string from the Status message</span>
    <span class="k">print</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="protocol-buffer-encoding">
<span id="communication-protocol-protobuf-encoding"></span><h2>Protocol Buffer Encoding<a class="headerlink" href="#protocol-buffer-encoding" title="Permalink to this headline">¶</a></h2>
<p>Values passed as arguments or received as return values are encoded using the
Protocol Buffer version 3 serialization format:</p>
<ul class="simple">
<li>Documentation for this encoding can be found here:
<a class="reference external" href="https://developers.google.com/protocol-buffers/docs/encoding">https://developers.google.com/protocol-buffers/docs/encoding</a></li>
<li>Protocol Buffer libraries in many languages are available here:
<a class="reference external" href="https://github.com/google/protobuf/releases">https://github.com/google/protobuf/releases</a></li>
</ul>
</div>
<div class="section" id="streams">
<span id="communication-protocol-streams"></span><h2>Streams<a class="headerlink" href="#streams" title="Permalink to this headline">¶</a></h2>
<p>Streams allow the client to repeatedly execute an RPC on the server and receive
its results, without needing to repeatedly call the RPC directly, avoiding the
communication overhead that this would involve.</p>
<p>A client can create a stream on the server by calling
<a class="reference internal" href="#communication-protocol-add-stream"><span>AddStream</span></a>. Once the client is finished with the
stream, it can remove it from the server by calling
<a class="reference internal" href="#communication-protocol-remove-stream"><span>RemoveStream</span></a>. Streams are automatically removed
when the client that created it disconnects from the server. Streams are local
to each client and there is no way to share a stream between clients.</p>
<p>The RPC for each stream is invoked every <a class="reference external" href="http://docs.unity3d.com/ScriptReference/MonoBehaviour.FixedUpdate.html">fixed update</a> and
the return values for all of these RPCs are collected together into a <em>stream
message</em>. This is then sent to the client over the stream server&#8217;s TCP/IP
connection. If the value returned by a stream&#8217;s RPC does not change since the
last update that was sent, its value is omitted from the update message in order
to minimize network traffic.</p>
<div class="section" id="anatomy-of-a-stream-message">
<h3>Anatomy of a Stream Message<a class="headerlink" href="#anatomy-of-a-stream-message" title="Permalink to this headline">¶</a></h3>
<p>A stream message is sent to the client using a <code class="docutils literal"><span class="pre">StreamMessage</span></code> Protocol Buffer
message with the following format:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">StreamMessage</span> <span class="p">{</span>
  <span class="k">repeated</span> <span class="n">StreamResponse</span> <span class="na">responses</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This contains a list of <code class="docutils literal"><span class="pre">StreamResponse</span></code> messages, one for each stream that
exists on the server for that client, and whose return value changed since the
last update was sent. It has the following format:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">StreamResponse</span> <span class="p">{</span>
  <span class="kt">uint32</span> <span class="na">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">Response</span> <span class="na">response</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The fields are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">id</span></code> - The identifier of the stream. This is the value returned by
<a class="reference internal" href="#communication-protocol-add-stream"><span>AddStream</span></a> when the stream is created.</li>
<li><code class="docutils literal"><span class="pre">response</span></code> - A <code class="docutils literal"><span class="pre">Response</span></code> message containing the result of the stream&#8217;s
RPC. This is identical to the <code class="docutils literal"><span class="pre">Response</span></code> message returned when calling the
RPC directly. See <a class="reference internal" href="#communication-protocol-anatomy-of-a-response"><span>Anatomy of a Response</span></a> for
details on the format and contents of this message.</li>
</ul>
</div>
</div>
<div class="section" id="krpc-service">
<span id="communication-protocol-krpc-service"></span><h2>KRPC Service<a class="headerlink" href="#krpc-service" title="Permalink to this headline">¶</a></h2>
<p>The server provides a service called <code class="docutils literal"><span class="pre">KRPC</span></code> containing procedures that are
used to retrieve information about the server and to manage streams.</p>
<div class="section" id="getstatus">
<h3>GetStatus<a class="headerlink" href="#getstatus" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">GetStatus</span></code> procedure returns status information about the server. It
returns a Protocol Buffer message with the format:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Status</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">version</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">uint64</span> <span class="na">bytes_read</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">uint64</span> <span class="na">bytes_written</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">float</span> <span class="na">bytes_read_rate</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="kt">float</span> <span class="na">bytes_written_rate</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="kt">uint64</span> <span class="na">rpcs_executed</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
  <span class="kt">float</span> <span class="na">rpc_rate</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="na">one_rpc_per_update</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="kt">uint32</span> <span class="na">max_time_per_update</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="na">adaptive_rate_control</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="na">blocking_recv</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
  <span class="kt">uint32</span> <span class="na">recv_timeout</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
  <span class="kt">float</span> <span class="na">time_per_rpc_update</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
  <span class="kt">float</span> <span class="na">poll_time_per_rpc_update</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
  <span class="kt">float</span> <span class="na">exec_time_per_rpc_update</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
  <span class="kt">uint32</span> <span class="na">stream_rpcs</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
  <span class="kt">uint64</span> <span class="na">stream_rpcs_executed</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
  <span class="kt">float</span> <span class="na">stream_rpc_rate</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
  <span class="kt">float</span> <span class="na">time_per_stream_update</span> <span class="o">=</span> <span class="mi">19</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">version</span></code> field contains the version string of the server. The remaining
fields contain performance information about the server.</p>
</div>
<div class="section" id="getservices">
<span id="communication-protocol-get-services"></span><h3>GetServices<a class="headerlink" href="#getservices" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">GetServices</span></code> procedure returns a Protocol Buffer message containing
information about all of the services and procedures provided by the server. It
also provides type information about each procedure, in the form of
<a class="reference internal" href="#communication-protocol-attributes"><span>attributes</span></a>. The format of the message
is:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Services</span> <span class="p">{</span>
  <span class="k">repeated</span> <span class="n">Service</span> <span class="na">services</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This contains a single field, which is a list of <code class="docutils literal"><span class="pre">Service</span></code> messages with
information about each service provided by the server. The content of these
<code class="docutils literal"><span class="pre">Service</span></code> messages are <a class="reference internal" href="#communication-protocol-service-description-message"><span>documented below</span></a>.</p>
</div>
<div class="section" id="addstream">
<span id="communication-protocol-add-stream"></span><h3>AddStream<a class="headerlink" href="#addstream" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">AddStream</span></code> procedure adds a new stream to the server. It takes a single
argument containing the RPC to invoke, encoded as a <code class="docutils literal"><span class="pre">Request</span></code> object. See
<a class="reference internal" href="#communication-protocol-anatomy-of-a-request"><span>Anatomy of a Request</span></a> for the format and contents
of this object. See <a class="reference internal" href="#communication-protocol-streams"><span>Streams</span></a> for more information
on working with streams.</p>
</div>
<div class="section" id="removestream">
<span id="communication-protocol-remove-stream"></span><h3>RemoveStream<a class="headerlink" href="#removestream" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">RemoveStream</span></code> procedure removes a stream from the server. It takes a
single argument &#8211; the identifier of the stream to be removed. This is the
identifier returned when the stream was added by calling
<a class="reference internal" href="#communication-protocol-add-stream"><span>AddStream</span></a>. See
<a class="reference internal" href="#communication-protocol-streams"><span>Streams</span></a> for more information on working with
streams.</p>
</div>
</div>
<div class="section" id="service-description-message">
<span id="communication-protocol-service-description-message"></span><h2>Service Description Message<a class="headerlink" href="#service-description-message" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#communication-protocol-get-services"><span>GetServices procedure</span></a> returns
information about all of the services provided by the server. Details about a
service are given by a <code class="docutils literal"><span class="pre">Service</span></code> message, with the format:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Service</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">Procedure</span> <span class="na">procedures</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">Class</span> <span class="na">classes</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">Enumeration</span> <span class="na">enumerations</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">documentation</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The fields are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">name</span></code> - The name of the service.</li>
<li><code class="docutils literal"><span class="pre">procedures</span></code> - A list of <code class="docutils literal"><span class="pre">Procedure</span></code> messages, one for each procedure
defined by the service.</li>
<li><code class="docutils literal"><span class="pre">classes</span></code> - A list of <code class="docutils literal"><span class="pre">Class</span></code> messages, one for each <a class="reference internal" href="extending.html#attribute-KRPCClass" title="KRPCClass attribute"><code class="xref csharp csharp-attr docutils literal"><span class="pre">KRPCClass</span></code></a>
defined by the service.</li>
<li><code class="docutils literal"><span class="pre">enumerations</span></code> - A list of <code class="docutils literal"><span class="pre">Enumeration</span></code> messages, one for each
<a class="reference internal" href="extending.html#attribute-KRPCEnum" title="KRPCEnum attribute"><code class="xref csharp csharp-attr docutils literal"><span class="pre">KRPCEnum</span></code></a> defined by the service.</li>
<li><code class="docutils literal"><span class="pre">documentation</span></code> - Documentation for the service, as <a class="reference external" href="https://msdn.microsoft.com/en-us/library/aa288481%28v=vs.71%29.aspx">C# XML documentation</a>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See the <a class="reference internal" href="extending.html#extending"><span>Extending kRPC</span></a> documentation for more details about
<a class="reference internal" href="extending.html#attribute-KRPCClass" title="KRPCClass attribute"><code class="xref csharp csharp-attr docutils literal"><span class="pre">KRPCClass</span></code></a> and <a class="reference internal" href="extending.html#attribute-KRPCEnum" title="KRPCEnum attribute"><code class="xref csharp csharp-attr docutils literal"><span class="pre">KRPCEnum</span></code></a>.</p>
</div>
<div class="section" id="procedures">
<h3>Procedures<a class="headerlink" href="#procedures" title="Permalink to this headline">¶</a></h3>
<p>Details about a procedure are given by a <code class="docutils literal"><span class="pre">Procedure</span></code> message, with the format:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Procedure</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">Parameter</span> <span class="na">parameters</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="na">has_return_type</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">return_type</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">attributes</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">documentation</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">Parameter</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="na">has_default_value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">bytes</span> <span class="na">default_value</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The fields are:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">name</span></code> - The name of the procedure.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">parameters</span></code> - A list of <code class="docutils literal"><span class="pre">Parameter</span></code> messages containing details of the
procedure&#8217;s parameters, with the following fields:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">name</span></code> - The name of the parameter, to allow parameter passing by name.</li>
<li><code class="docutils literal"><span class="pre">type</span></code> - The <a class="reference internal" href="#communication-protocol-type-names"><span>type</span></a> of the
parameter.</li>
<li><code class="docutils literal"><span class="pre">has_default_value</span></code> - True if the parameter has a default value.</li>
<li><code class="docutils literal"><span class="pre">default_value</span></code> - If <code class="docutils literal"><span class="pre">has_default_value</span></code> is true, contains the
value of the default value of the parameter, <a class="reference internal" href="#communication-protocol-protobuf-encoding"><span>encoded using Protocol
Buffer format</span></a>.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">has_return_type</span></code> - True if the procedure returns a value.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">return_type</span></code> - If <code class="docutils literal"><span class="pre">has_return_type</span></code> is true, contains the <a class="reference internal" href="#communication-protocol-type-names"><span>return
type</span></a> of the procedure.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">attributes</span></code> - The procedure&#8217;s <a class="reference internal" href="#communication-protocol-attributes"><span>attributes</span></a>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">documentation</span></code> - Documentation for the procedure, as <a class="reference external" href="https://msdn.microsoft.com/en-us/library/aa288481%28v=vs.71%29.aspx">C# XML documentation</a>.</p>
</li>
</ul>
</div>
<div class="section" id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h3>
<p>Details about each <a class="reference internal" href="extending.html#attribute-KRPCClass" title="KRPCClass attribute"><code class="xref csharp csharp-attr docutils literal"><span class="pre">KRPCClass</span></code></a> are specified in a <code class="docutils literal"><span class="pre">Class</span></code>
message, with the format:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Class</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">documentation</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The fields are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">name</span></code> - The name of the class.</li>
<li><code class="docutils literal"><span class="pre">documentation</span></code> - Documentation for the class, as <a class="reference external" href="https://msdn.microsoft.com/en-us/library/aa288481%28v=vs.71%29.aspx">C# XML documentation</a>.</li>
</ul>
</div>
<div class="section" id="enumerations">
<h3>Enumerations<a class="headerlink" href="#enumerations" title="Permalink to this headline">¶</a></h3>
<p>Details about each <a class="reference internal" href="extending.html#attribute-KRPCEnum" title="KRPCEnum attribute"><code class="xref csharp csharp-attr docutils literal"><span class="pre">KRPCEnum</span></code></a> are specified in an <code class="docutils literal"><span class="pre">Enumeration</span></code>
message, with the format:</p>
<div class="highlight-protobuf"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">Enumeration</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">EnumerationValue</span> <span class="na">values</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">documentation</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">EnumerationValue</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int32</span> <span class="na">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">documentation</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The fields are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">name</span></code> - The name of the enumeration.</li>
<li><code class="docutils literal"><span class="pre">values</span></code> - A list of <code class="docutils literal"><span class="pre">EnumerationValue</span></code> messages, indicating the values
that the enumeration can be assigned. The fields are:<ul>
<li><code class="docutils literal"><span class="pre">name</span></code> - The name associated with the value for the enumeration.</li>
<li><code class="docutils literal"><span class="pre">value</span></code> - The possible value for the enumeration as a 32-bit integer.</li>
<li><code class="docutils literal"><span class="pre">documentation</span></code> - Documentation for the enumeration value, as <a class="reference external" href="https://msdn.microsoft.com/en-us/library/aa288481%28v=vs.71%29.aspx">C# XML documentation</a>.</li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">documentation</span></code> - Documentation for the enumeration, as <a class="reference external" href="https://msdn.microsoft.com/en-us/library/aa288481%28v=vs.71%29.aspx">C# XML documentation</a>.</li>
</ul>
</div>
<div class="section" id="attributes">
<span id="communication-protocol-attributes"></span><h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h3>
<p>Additional type information about a procedure is encoded as a list of
attributes, and included in the <code class="docutils literal"><span class="pre">Procedure</span></code> message. For example, if the
procedure implements a method for a class (see <a class="reference internal" href="#communication-protocol-proxy-objects"><span>proxy objects</span></a>) this fact will be specified in the
attributes.</p>
<p>The following attributes specify what the procedure implements:</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal"><span class="pre">Property.Get(property-name)</span></code></p>
<p>Indicates that the procedure is a property getter (for the service) with the
given <code class="docutils literal"><span class="pre">property-name</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">Property.Set(property-name)</span></code></p>
<p>Indicates that the procedure is a property setter (for the service) with the
given <code class="docutils literal"><span class="pre">property-name</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">Class.Method(class-name,method-name)</span></code></p>
<p>Indicates that the procedure is a method for a class with the given
<code class="docutils literal"><span class="pre">class-name</span></code> and <code class="docutils literal"><span class="pre">method-name</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">Class.StaticMethod(class-name,method-name)</span></code></p>
<p>Indicates that the procedure is a static method for a class with the given
<code class="docutils literal"><span class="pre">class-name</span></code> and <code class="docutils literal"><span class="pre">method-name</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">Class.Property.Get(class-name,property-name)</span></code></p>
<p>Indicates that the procedure is a property getter for a class with the given
<code class="docutils literal"><span class="pre">class-name</span></code> and <code class="docutils literal"><span class="pre">property-name</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">Class.Property.Set(class-name,property-name)</span></code></p>
<p>Indicates that the procedure is a property setter for a class with the given
<code class="docutils literal"><span class="pre">class-name</span></code> and <code class="docutils literal"><span class="pre">property-name</span></code>.</p>
</li>
</ul>
</div></blockquote>
<p>The following attributes specify more details about the return and parameter types of the procedure.</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal"><span class="pre">ReturnType.type-name</span></code></p>
<p>Specifies the actual <a class="reference internal" href="#communication-protocol-type-names"><span>return type</span></a>
of the procedure, if it differs to the type specified in the <code class="docutils literal"><span class="pre">Procedure</span></code>
message. For example, this is used with <a class="reference internal" href="#communication-protocol-proxy-objects"><span>proxy objects</span></a>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ParameterType(parameter-position).type-name</span></code></p>
<p>Specifies the actual <a class="reference internal" href="#communication-protocol-type-names"><span>parameter type</span></a> of the procedure, if it differs to the
type of the corresponding parameter specified in the <code class="docutils literal"><span class="pre">Parameter</span></code>
message. For example, this is used with <a class="reference internal" href="#communication-protocol-proxy-objects"><span>proxy objects</span></a>.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="type-names">
<span id="communication-protocol-type-names"></span><h3>Type Names<a class="headerlink" href="#type-names" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">GetServices</span></code> procedure returns type information about parameters and
return values as strings. Type names can be any of the following:</p>
<blockquote>
<div><ul class="simple">
<li>A Protocol Buffer value type. One of <code class="docutils literal"><span class="pre">float</span></code>, <code class="docutils literal"><span class="pre">double</span></code>, <code class="docutils literal"><span class="pre">int32</span></code>,
<code class="docutils literal"><span class="pre">int64</span></code>, <code class="docutils literal"><span class="pre">uint32</span></code>, <code class="docutils literal"><span class="pre">uint64</span></code>, <code class="docutils literal"><span class="pre">bool</span></code>, <code class="docutils literal"><span class="pre">string</span></code> or <code class="docutils literal"><span class="pre">bytes</span></code>.</li>
<li>A <a class="reference internal" href="extending.html#attribute-KRPCClass" title="KRPCClass attribute"><code class="xref csharp csharp-attr docutils literal"><span class="pre">KRPCClass</span></code></a> in the format <code class="docutils literal"><span class="pre">Class(ClassName)</span></code></li>
<li>A <a class="reference internal" href="extending.html#attribute-KRPCEnum" title="KRPCEnum attribute"><code class="xref csharp csharp-attr docutils literal"><span class="pre">KRPCEnum</span></code></a> in the format <code class="docutils literal"><span class="pre">Enum(ClassName)</span></code></li>
<li>A Protocol Buffer message type, in the format <code class="docutils literal"><span class="pre">KRPC.MessageType</span></code>. Only
message types defined in <code class="docutils literal"><span class="pre">krpc.proto</span></code> are permitted.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="proxy-objects">
<span id="communication-protocol-proxy-objects"></span><h3>Proxy Objects<a class="headerlink" href="#proxy-objects" title="Permalink to this headline">¶</a></h3>
<p>kRPC allows procedures to create objects on the server, and pass a unique
identifier for them to the client. This allows the client to create a <em>proxy</em>
object for the actual object, whose methods and properties make remote procedure
calls to the server. Object identifiers have type <code class="docutils literal"><span class="pre">uint64</span></code>.</p>
<p>When a procedure returns a proxy object, the procedure will have the attribute
<code class="docutils literal"><span class="pre">ReturnType.Class(ClassName)</span></code> where <code class="docutils literal"><span class="pre">ClassName</span></code> is the name of the class.</p>
<p>When a procedure takes a proxy object as a parameter, the procedure will have
the attribute <code class="docutils literal"><span class="pre">ParameterType(n).Class(ClassName)</span></code> where <code class="docutils literal"><span class="pre">n</span></code> is the position
of the parameter and <code class="docutils literal"><span class="pre">ClassName</span></code> is the name of the class.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="internals.html" class="btn btn-neutral float-right" title="Internals of kRPC" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="extending.html" class="btn btn-neutral" title="Extending kRPC" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2016, djungelorm.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.3.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61341323-1', 'auto');
  ga('send', 'pageview');
</script>

<script>
  // Open external links in a new window
  jQuery(document).ready(function($) {
    $('a').not('[href*="mailto:"]').each(function () {
      var isInternalLink = new RegExp('/' + window.location.host + '/');
      if (!isInternalLink.test(this.href)) {
        $(this).attr('target', '_blank');
      }
    });
  });
</script>


</body>
</html>